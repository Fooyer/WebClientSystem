<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="style.css">

    <title>Clientes</title>
</head>
<body onload="montaTabela();">
    
    <header>
    
        <ul class="mainMenu">
    
            <li><a href="./../../" class="mainOption">Home</a></li>
    
            <li><a href="./" class="mainOption">Clientes</a></li>
    
            <li><a href="" class="mainOption">Produtos</a></li>
                
            <li><a href="" class="mainOption">Orçamentos</a></li>
    
        </ul>
    
    </header>

    <div class="crudCliente">

        <div id="caixaFormulario">
            <form action="./../data_operations/salvarCliente.php" method="get" class="formularioCliente">

                <div id="campoID">
                    <label for="ID" id="labelID">ID</label>
                    <input type="text" readonly name="ID" id="clienteID">
                </div> <br>

                <div id="cambut">

                    <div id="camposDados">
                        <div>
                            <label for="Nome">Nome</label><br>
                            <input type="text" name="Nome" id="">
                        </div> <br>
                        <div>
                            <label for="Email">Email</label><br>
                            <input type="email" name="Email" id="">
                        </div> <br>
                        <div>
                            <label for="Telefone">Telefone</label><br>
                            <input type="tel" name="Telefone" id="">
                        </div> <br>
                    </div>

                    <div id="buttons">
                        <button type="submit" id="botaoSalvar">Salvar</button>
                        <button type="reset" id="botaoCancelar" onclick="resetForm()">Cancelar</button>
                    </div>

                </div>

            </form>
        </div>

        <table class="tabelaCliente">

            <thead>
                <th>ID</th>
                <th>Nome</th>
                <th>Email</th>
                <th>Telefone</th>
            </thead>

            <tbody id="my-table">

            </tbody>
        </table>

        <button id="prev-page">Página Anterior</button>
        <button id="next-page">Página Seguinte</button>

    </div>

</body>
</html>

<script>

    let flagSelec = 0
    let eventoAnt = 0

    function obterDadosLinhaTabela(event){

        var tds = event.path[1].getElementsByTagName("td");
        var inputs = document.getElementsByClassName("formularioCliente")[0].getElementsByTagName("input");
        console.log(inputs)

        for (var i = 0; i < tds.length; i++) {

            var td = tds[i];
            var conteudo =td.textContent.trim();

            inputs[i].value = conteudo;

        }


        if (flagSelec == 0){

            event.path[1].style.background = "yellow";

            flagSelec = 1
            eventoAnt = event

        }
        else{
            
            eventoAnt.path[1].style.background = "rgb(235, 235, 255)";

            flagSelec = 1
            eventoAnt = event
            event.path[1].style.background = "yellow";

        }

    }

    function resetForm(){

        eventoAnt.path[1].style.background = "rgb(235, 235, 255)";
       
        flagSelec = 0
        eventoAnt = 0

    }

</script>
<script>

    const rowsPerPage = 10;
    let currentPage = 1;

    async function renderTable() {

        let tableData;

        await fetch('./../data_operations/obterClientes.php').then(Response => Response.json()).then(data => tableData = data)
        
        console.log(tableData)

        const table = document.getElementById('my-table');

        const startIndex = (currentPage - 1) * rowsPerPage;
        const endIndex = startIndex + rowsPerPage;

        table.innerHTML = '';

        for (let i = startIndex; i < endIndex; i++) {
            const row = tableData[i];
            if (!row) break;

            const tr = document.createElement('tr');
            tr.id = "linhaTabela"
            tr.setAttribute("onclick", "obterDadosLinhaTabela(event)");
            tr.innerHTML = `
            <td>${row.id}</td>
            <td>${row.nome}</td>
            <td>${row.email}</td>
            <td>${row.telefone}</td>
            `;

            table.appendChild(tr);
        }
    }

    function prevPage() {

        if (currentPage > 1) {
            currentPage--;
            renderTable();
        }

    }

    function nextPage() {

        if (currentPage < tableData.length / rowsPerPage) {
            currentPage++;
            renderTable();
        }

    }

    document.getElementById('prev-page').addEventListener('click', prevPage);
    document.getElementById('next-page').addEventListener('click', nextPage);

    window.onload = function() {

        renderTable();

    };


</script>